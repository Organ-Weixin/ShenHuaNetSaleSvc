<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link rel="stylesheet" type="text/css" media="screen" href="../../css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="../../css/select-addl.min.css"/>
<link rel="stylesheet" type="text/css" href="../../css/select-krajee.min.css"/>
<link rel="stylesheet" type="text/css" href="../../css/select.min.css"/>
</head>
<body>
<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
	<input type="hidden" id="userId">
	<input type="hidden" id="roleId">
	<input type="hidden" id="CinemaCodes">
	<form class="form-horizontal" onsubmit="return false" id="form">
		<input class='form-control' type='hidden' name='couponsType' id='CouponsType'>
		<fieldset>
			<div class='form-group' style="margin-top:3%">
				<label class='col-md-2 control-label'>优惠券名称&nbsp;<font style="color:red;font-size:15px">*</font></label>
				<div class='col-md-10'>
					<input class='form-control' type='text' name='couponsName' id='CouponsName' data-bv-notempty='true' data-bv-notempty-message='优惠券名称不能为空' style="width:30%">
				</div>
			</div>
			<div class='form-group' style="margin-top:3%">
				<label class='col-md-2 control-label'>有效期&nbsp;<font style="color:red;font-size:15px">*</font></label>
				<div class='col-md-10' style="font-size:15px">
					<div>
						<input type="hidden" id="validityType" name="validityType">
						<input type="radio" name="ValidityTypeRadio" value="1"> 固定日期
						<input type="text" id="effectiveDate" placeholder="请选择日期" name="effectiveDate">
						至
						<input type="text" id="expireDate" placeholder="请选择日期" name="expireDate">
					</div>
					<!-- <div style="margin-top:2%">
						<input type="radio" name="ValidityTypeRadio" value="2"> 领取后,
						<select id="effectiveDays" name="effectiveDays">
							<option value="">请选择</option>
							<option value="0">当天</option>
							<option value="1">次日</option>
							<option value="6">一周后</option>
						</select>
						生效，有效天数
						<select id="validityDays" name="validityDays">
							<option value="">请选择</option>
							<option value="7">一周</option>
							<option value="30">30天</option>
							<option value="180">180天</option>
						</select>
					</div> -->
				</div>
			</div>
			<div class='form-group' style="margin-top:2%">
				<label class='col-md-2 control-label'>可用时段&nbsp;<font style="color:red;font-size:15px">*</font></label>
				<div class='col-md-10' style="font-size:15px">
					<input type="hidden" id="canUsePeriodType" name="canUsePeriodType">
					<div>
						<input type="radio" name="CanUsePeriodTypeRadio" value="1">
						全部时段
					</div>
					<!-- <div style="margin-top:2%">
						<div>
							<input type="radio" name="CanUsePeriodTypeRadio" value="2">
							部分时段
						</div>
						<div id="checkCanUseDate" style="display:none">
							<div style="margin-top:1%">
							<input type="hidden" id="weekDays" name="weekDays">
								日期：
									<input type="checkbox" class="checkWeek" style="margin-left:2%" value="2">周一
									<input type="checkbox" class="checkWeek" style="margin-left:2%" value="3">周二
									<input type="checkbox" class="checkWeek" style="margin-left:2%" value="4">周三
									<input type="checkbox" class="checkWeek" style="margin-left:2%" value="5">周四
									<input type="checkbox" class="checkWeek" style="margin-left:2%" value="6">周五
									<input type="checkbox" class="checkWeek" style="margin-left:2%" value="7">周六
									<input type="checkbox" class="checkWeek" style="margin-left:2%" value="1">周日
								<br>
							</div>
							<div style="margin-top:1%">
								<div style="float:left">
									<input type="hidden" id="timePeriod" name="timePeriod">
									其他日期：
								</div>
								<div id="canUseDate" style="float:left;width:50%;margin-left:2%">
									<input type="text" class="canUseDateStart">
									至
									<input type="text" class="canUseDateEnd">
									<span style="margin-left:2%;cursor: pointer;" id="addTime">添加时段</span>
								</div>
							</div>
							<div style="width:30%;margin-top:5%;margin-left:10%">
								<font style="color:gray;font-size:15px">
								请使用24小时制输入时间，格式如11:00至14:30
								</font>
							</div>	
						</div>
					</div> -->
				</div>
			</div>
			<div class='form-group' style="margin-top:3%">
				<label class='col-md-2 control-label'>适用门店&nbsp;<font style="color:red;font-size:15px">*</font></label>
				<div class='col-md-10' style="font-size:15px">
					<input type="hidden" id="canUseCinemaType" name="canUseCinemaType">
					<div>
						<input type="radio" name="CanUseCinemaTypeRadio" value="1"> 全部门店使用
					</div>
					<div style="margin-top:2%">
						<input type="radio" name="CanUseCinemaTypeRadio" value="2"> 指定门店
						<div id="Cinemas" style="margin-top:2%;display:none">
							<input type="hidden" id="cinemaCodes" name="cinemaCodes">
							<input type="hidden" id="AllCinemaCodes">
							<select id="CinemasSelect" class="form-control" multiple data-s2-options="s2options" data-krajee-select2="selectcinema">
							</select>
						</div>
					</div>
				</div>
			</div>
			<div class='form-group' style="margin-top:5%" style="margin-top:3%">
				<label class='col-md-2 control-label'>领券限制&nbsp;<font style="color:red;font-size:15px">*</font></label>
				<div class='col-md-10'>
					<div>
						<input class='form-control' value="1" type='text' name='limitNum' id='LimitNum' style="width:20%;float:left">
						<font style="font-size:18px;margin-left:5px">张</font>
					</div>
					<div style="margin-top:1%">
						<font style="color:gray;font-size:15px">
							每个用户领券限制，默认为1
						</font>
					</div>
				</div>
			</div>
			<div class='form-group' style="margin-top:3%">
				<label class='col-md-2 control-label'>减免金额&nbsp;<font style="color:red;font-size:15px">*</font></label>
				<input type="hidden" id="reductionType" name="reductionType">
				<input type="hidden" id="InitialAmount" name="initialAmount">
				<input type="hidden" id="reductionPrice" name="reductionPrice">
				<div class='col-md-10' style="font-size:15px">
					<div style="margin-top:2%">
						<input type="radio" name="reductionTypeRadio" value="1">影片
						<span id="filminitialAmount">
							&nbsp;&nbsp;满&nbsp;
							<input type="text" style="width:10%" id="filmInitialAmount" name="initialAmount">&nbsp;
						</span>
						<span id="filmReduction">
							&nbsp;&nbsp;减&nbsp;
							<input type="text" style="width:10%" id="filmReductionPrice">&nbsp;金额
						</span>
						<!-- <div id="Films" style="margin-top:2%;display:none">
						<input type="radio" style="margin-left:3%" id="checkFilms" name="FilmOrGoodRadio">指定影片可用
						</div>
						<div id="filmsDiv" style="margin-top:2%;display:none">
							<input type="hidden" id="filmCodes" name="filmCodes">
							<select id="FilmsSelect" class="form-control" multiple data-s2-options="s2options" data-krajee-select2="selectfilm">
							</select>
						</div>  -->
					</div>
					<div style="margin-top:2%">
						<input type="radio" name="reductionTypeRadio" value="2">卖品
						<span id="goodinitialAmount">
							&nbsp;&nbsp;满&nbsp;
							<input type="text" style="width:10%" id="goodInitialAmount">&nbsp;
						</span>
						<span id="goodReduction">
							&nbsp;&nbsp;减&nbsp;
							<input type="text" style="width:10%" id="goodReductionPrice">&nbsp;金额
						</span>
						<!-- <div id="Goods" style="margin-top:2%;display:none">
						<input type="radio" style="margin-left:3%" id='checkGoods' name="FilmOrGoodRadio">指定卖品可用
						</div>
						<div id="goodsDiv" style="margin-top:2%;display:none">
							<input type="hidden" id="goodsCodes" name="goodsCodes">
							<select id="GoodsSelect" class="form-control" multiple data-s2-options="s2options" data-krajee-select2="selectgood">
						</select> 
						</div> -->
					</div>
					<div style="margin-top:2%">
						优惠共享
						<select id="isShare" name="isShare"> 
							<option value="0">不可共享</option>
							<option value="1">可共享</option>
						</select>
					</div>
					<div style="margin-top:2%">
						是否可与会员卡叠加使用
						<select id="isShareWithMemberCard" name="isShareWithMemberCard"> 
							<option value="0">不可叠加</option>
							<option value="1">可叠加</option>
						</select>
					</div>
				</div>
			</div>			
			<div class='form-group' style="margin-top:3%">
				<label class='col-md-2 control-label'>使用须知</label>
				<div class='col-md-10'>
					<textarea style="width:70%;height:100px" name="remark"></textarea>
				</div>
			</div>
			<div class='form-group' style="margin-top:3%">
				<label class='col-md-2 control-label'>库存&nbsp;<font style="color:red;font-size:15px">*</font></label>
				<div class='col-md-10'>
					<input class='form-control' type='text' name='couponsNumber' id='CouponsNumber' data-bv-notempty='true' data-bv-notempty-message='库存不能为空' style="width:20%;float:left">
					<font style="font-size:18px;margin-left:5px">份，自动生成相应券码（可在优惠券管理&nbsp;<font style="color:blur">券码</font>&nbsp;处下载）</font>
				</div>
			</div>

			<div class="form-actions">
				<div class="row" align="center">
					<div class="col-md-12">
					    <button class="btn btn-primary" onclick="location.href='couponsgroupList.html'">取消</button>
						<button class="btn btn-primary" type="submit" onclick="add()">
							<i class="fa fa-save"></i> 创建	
						</button>
					</div>
				</div>
			</div>

		</fieldset>
	</form>
</div>
	<script type="text/javascript" src="../../js/libs/jquery-2.1.1.min.js"></script>
	<script type="text/javascript" src="../../js/jq.js"></script>
	<script type="text/javascript" src="../../js/plugin/bootstrapvalidator/bootstrapValidator.min.js"></script>
	<script type="text/javascript" src="../../js/common.js"></script>
	<script type="text/javascript" src="../../layui/layui.js"></script>
	<script type="text/javascript" src="../../js/select2.full.min.js"></script>
	<script type="text/javascript" src="../../js/select2-krajee.min.js"></script>
	<script type="text/javascript">
	function getUrlParam(name) {//封装方法    
		var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象    
		var r = window.location.search.substr(1).match(reg); //匹配目标参数    
		if (r != null) {
			return unescape(r[2]);    
		}
		
		return null; //返回参数值
	}
	$("#CouponsType").val(getUrlParam("CouponsType"));
	if(getUrlParam("CouponsType")==2){
		$("#filmReduction").hide();
		$("#goodinitialAmount").hide();
		$("#goodReduction").hide();
	}
	//影片下拉多选
	var filmoptions = {"doReset":true,"doToggle":true,"doOrder":false};
	window.filmoptions = {"theme":"krajee","width":"50%","placeholder":"请选择影片","language":"zh-CN"};
	if (jQuery('#FilmsSelect').data('selectfilm')){
		jQuery('#FilmsSelect').select2('destroy');
	}
	jQuery.when(jQuery('#FilmsSelect').select2(filmoptions)).done(initS2Loading('FilmsSelect','filmoptions'));
	
	//卖品下拉多选
	var goodoptions = {"doReset":true,"doToggle":true,"doOrder":false};
	window.goodoptions = {"theme":"krajee","width":"50%","placeholder":"请选择卖品","language":"zh-CN"};
	if (jQuery('#GoodsSelect').data('selectgood')){
		jQuery('#GoodsSelect').select2('destroy');
	}
	jQuery.when(jQuery('#GoodsSelect').select2(goodoptions)).done(initS2Loading('GoodsSelect','goodoptions'));
	
	//影院下拉多选
	var cinemaoptions = {"doReset":true,"doToggle":true,"doOrder":false};
	window.cinemaoptions = {"theme":"krajee","width":"50%","placeholder":"请选择影院","language":"zh-CN"};
	if (jQuery('#CinemasSelect').data('selectcinema')){
		jQuery('#CinemasSelect').select2('destroy');
	}
	jQuery.when(jQuery('#CinemasSelect').select2(cinemaoptions)).done(initS2Loading('GoodsSelect','cinemaoptions'));
	
	window.onload=function(){
		//获取影院列表
		getCinema();
		function getCinema(){
			$.ajax({
				url:'/users/getCinemaName',
				data:{"id":$("#userId").val(),"roleId":$("#roleId").val()},
				type:'post',
				success:function(data){
					var cinemacodes = "";
					for(var i=0; i<data.length; i++){
						var option = "<option value='"+data[i].cinemaCode+"'>"+data[i].cinemaName+"</option>";
						cinemacodes +=data[i].cinemaCode+",";
						$("#CinemasSelect").append(option);
					}
					$("#AllCinemaCodes").val(cinemacodes.substring(0,cinemacodes.length-1));
				}
			});
		}
///////////////////////////////////////////////////////////////
	}
		layui.use(['layer','laydate'], function(){
		    var layer = layui.layer;
		    var laydate = layui.laydate;
		    laydate.render({
		       elem: '#effectiveDate',
		       type: 'datetime',
		       format: 'yyyy-MM-dd',
		       min: 'nowTime'
		    });
		    laydate.render({
			   elem: '#expireDate',
			   type: 'datetime',
			   format: 'yyyy-MM-dd'
			});
		});
		
		//获取登陆人信息
		initUser();
		function initUser(){
			$.ajax({
				type : 'get',
				url : '/users/current',
				async : false,
				success : function(data) {
					$("#userId").val(data.id);
					$("#roleId").val(data.roleId);
				}
			});
		}
		
		//有效期选择
		$("input:radio[name='ValidityTypeRadio']").click(function(){
			if($(this).css("checked",true).val()==1){
				$("#effectiveDays").val(null);
				$("#validityDays").val(null);
			}
			if($(this).css("checked",true).val()==2){
				$("#effectiveDate").val(null);
				$("#expireDate").val(null);
			}
		});
		//可用时段选择
		$("input:radio[name='CanUsePeriodTypeRadio']").click(function(){
			if($(this).css("checked",true).val()==1){
				$("#checkCanUseDate").css("display","none");
				$("input[class='checkWeek']").removeAttr("checked");
				$("#canUseDateStart").val("");
				$("#canUseDateEnd").val("");
			}
			if($(this).css("checked",true).val()==2){
				$("#checkCanUseDate").css("display","block");
				$("input[class='checkWeek']").removeAttr("checked");
				$("#canUseDateStart").val("");
				$("#canUseDateEnd").val("");
			}
		});
		//添加可用时段
		$("#addTime").click(function(){
			var canUserDate = "<span class ='aa'><input style='margin-top:1%' type='text' class='canUseDateStart'>&nbsp;至&nbsp;";
			canUserDate = canUserDate + "<input style='margin-top:1%' type='text' class='canUseDateEnd'>";
			canUserDate = canUserDate + "<font style='margin-left:3%;cursor: pointer;' class='delTime'>删除</font></span><br>";
			$("#canUseDate").append(canUserDate);
		});
		//删除可用时段
		$("#canUseDate").on('click','.delTime',function(){
			$(this).parent().remove();
		})
		//适用门店选择
		$("input:radio[name='CanUseCinemaTypeRadio']").click(function(){
			if($(this).css("checked",true).val()==1){
				$("#Cinemas").css("display","none");
				$("input[class='checkCinemas']").removeAttr("checked");
			}
			if($(this).css("checked",true).val()==2){
				$("#Cinemas").css("display","block");
				$("input[class='checkCinemas']").removeAttr("checked");
			}
		});
		//减免金额选择
		$("input:radio[name='reductionTypeRadio']").click(function(){
			if($("input:radio[name='CanUseCinemaTypeRadio']:checked").length<=0){
				layer.msg("请选择门店");
			}else{
				if($(this).css("checked",true).val()==1){
					$("#Goods").css("display","none");
					$("#Films").css("display","block");
					$("#goodsDiv").css("display","none");
					$("#goodInitialAmount").val(null);
					$("#goodReductionPrice").val(null);
					$("#GoodsSelect").val(null);
				}
				if($(this).css("checked",true).val()==2){
					$("#Films").css("display","none");
					$("#Goods").css("display","block");
					$("#filmsDiv").css("display","none");
					$("#filmInitialAmount").val(null);
					$("#filmReductionPrice").val(null);
					$("#FilmsSelect").val(null);
				}
			}
		}); 
		//影片减免金额判断
		$("#filmReductionPrice").blur(function(){
			if($("input:radio[name='CanUseCinemaTypeRadio']:checked").val()==1){
				if($("#filmReductionPrice").val()>$("#filmInitialAmount").val()){
					$("#filmInitialAmount").val(null);
					$("#filmReductionPrice").val(null);
					layer.msg("减免金额不能大于总金额");
				}
			}
		});
		//卖品减免金额判断
		$("#goodReductionPrice").blur(function(){
			if($("input:radio[name='CanUseCinemaTypeRadio']:checked").val()==2){
				if($("#goodReductionPrice").val()>$("#goodInitialAmount").val()){
					$("#goodInitialAmount").val(null);
					$("#goodReductionPrice").val(null);
					layer.msg("减免金额不能大于总金额");
				}
			}
		});
		//减免金额选择影片
		$("#checkFilms").click(function(){
			if($("input:radio[name='CanUseCinemaTypeRadio']:checked").val()==1){
				getFilms($("#AllCinemaCodes").val());
			}else{
				getFilms($("#CinemasSelect").val().toString());
			}
			$("#Films").css("display","block");
			$("#goodsDiv").css("display","none");
		});
		//获取影片列表
		function getFilms(cinemacodes){
			$.ajax({
				url:'/sessioninfos/getFilmsByCinemaCode?cinemacodes='+cinemacodes,
				type:'post',
				success:function(data){
					$("#FilmsSelect").text('请选择卖品');
					for(var i=0;i<data.length;i++){
						var option = "<option value='"+data[i].filmCode+"'>"+data[i].filmName+"</option>";
						$("#FilmsSelect").append(option); 
					}
				}
			});
		}
		$("#Films").click(function(){
			$("#filmsDiv").css("display","block");
			$("#goodsDiv").css("display","none");
		});
		//减免金额选择卖品
		$("#checkGoods").click(function(){
			if($("input:radio[name='CanUseCinemaTypeRadio']:checked").val()==1){
				getGoods($("#AllCinemaCodes").val());
			}else{
				getGoods($("#CinemasSelect").val().toString());
			}
			$("#Goods").css("display","block");
			$("#filmsDiv").css("display","none");
		});
		//获取卖品列表
		function getGoods(cinemacodes){
			$.ajax({
				url:'/goodss/getGoodsByCinemaCode?cinemacodes='+cinemacodes,
				type:'post',
				success:function(data){
					$("#GoodsSelect").text('请选择卖品');
					for(var i=0;i<data.length;i++){
						var option = "<option value='"+data[i].goodsCode+"'>"+data[i].goodsName+"</option>";
						$("#GoodsSelect").append(option); 
					}
				}
			});
		}
		$("#Goods").click(function(){
			$("#goodsDiv").css("display","block");
			$("#filmsDiv").css("display","none");
		});
		//提交前验证所有内容
		function checkParams(){
			if($("#FilmsSelect").val()!=null&&$("#FilmsSelect").val()!=""){
				$("#filmCodes").val($("#FilmsSelect").val().toString());
			}else{
				$("#filmCodes").val(null);
			}
			if($("#GoodsSelect").val()!=null&&$("#GoodsSelect").val()!=""){
				$("#goodsCodes").val($("#GoodsSelect").val().toString());
			}else{
				$("#goodsCodes").val(null);
			}
			if($("#CinemasSelect").val()!=null&&$("#CinemasSelect").val()!=""){
				$("#cinemaCodes").val($("#CinemasSelect").val().toString());
			}else{
				$("#cinemaCodes").val(null);
			}
			$("#validityType").val($('input:radio[name="ValidityTypeRadio"]:checked').val());
			$("#canUsePeriodType").val($('input:radio[name="CanUsePeriodTypeRadio"]:checked').val());
			var weekDays = "";
			for(var i=0;i<$('input[class="checkWeek"]:checked').length;i++){
				weekDays +=$('input[class="checkWeek"]:checked').eq(i).val()+",";
			}
			$("#weekDays").val(weekDays.substring(0,weekDays.length-1));
			if($(".canUseDateStart").val()!=""&&$(".canUseDateStart").val()!=null&&$(".canUseDateEnd").val()!=""&&$(".canUseDateEnd").val()!=null){
				var timePeriod = "";
				for(var i=0; i<$(".canUseDateStart").length; i++){
					timePeriod += $(".canUseDateStart").eq(i).val()+"-"+$(".canUseDateEnd").eq(i).val()+",";
				}
				$("#timePeriod").val(timePeriod.substring(0,timePeriod.length-1));
			}else{
				$("#timePeriod").val(null);
			}
			$("#reductionType").val($('input:radio[name="reductionTypeRadio"]:checked').val());
			if($("input:radio[name='reductionTypeRadio']:checked").val()==1){
				$("#InitialAmount").val(null);
				$("#goodReductionPrice").val(null);
			}
			if($("input:radio[name='reductionTypeRadio']:checked").val()==2){
				$("#filmReductionPrice").val(null);
			}
			$("#InitialAmount").val($("#filmInitialAmount").val()+$("#goodInitialAmount").val());
			$("#reductionPrice").val($("#filmReductionPrice").val()+$("#goodReductionPrice").val());
			$("#canUseCinemaType").val($('input:radio[name="CanUseCinemaTypeRadio"]:checked').val());
		}
		
		//领券限制
		function LimitNumCheck(){
			var num = $("#LimitNum").val();
			if(!(/(^[1-9]\d*$)/.test(num))||num<=0){
				layer.msg("请输入正确的发放数量");
				$("#LimitNum").val("1");
			}
		}
		$("#LimitNum").blur(function(){
			LimitNumCheck();
		})
		function add() {
			checkParams();
		 	//提交之前非空判断
		 	//有效期
		 	var result = true;
			if($("input:radio[name='ValidityTypeRadio']:checked").length<=0){
				result = false;
				layer.msg("请选择有效期类型！");
			}else{
				if($("input:radio[name='ValidityTypeRadio']:checked").val()==1
						&&($("#effectiveDate").val()==null||$("#effectiveDate").val()==""
						||$("#expireDate").val()==null||$("#expireDate").val()=="")){
					 result = false;
					 layer.msg("请选择有效期！");
				}
				if($("input:radio[name='ValidityTypeRadio']:checked").val()==2
						&&($("#effectiveDays").val()==null||$("#effectiveDays").val()==""
						||$("#validityDays").val()==null||$("#validityDays").val()=="")){
					result = false;
					layer.msg("请选择有效时间！");
				}
			}
			//可用时段
			if($("input:radio[name='CanUsePeriodTypeRadio']:checked").length<=0){
				result = false;
				layer.msg("请选择可用时段类型！");
			}else{
				if($("input:radio[name='canUsePeriodType']:checked").val()==2&&$("input[class='checkWeek']:checked").length<=0){
					result = false;
					layer.msg("请选择可用时间！");
				}
			}
			//适用门店
			if($("input:radio[name='CanUseCinemaTypeRadio']:checked").length<=0){
				result = false;
				layer.msg("请选择使用门店类型！");
			}else{
				if($("input:radio[name='CanUseCinemaTypeRadio']:checked").val()==2&&($("#cinemaCodes").val()==null||$("#cinemaCodes").val()=="")){
					result = false;
					layer.msg("请选择适用门店！");
				}
			}
			//领券限制
			LimitNumCheck();
			//减免金额
			if(getUrlParam("CouponsType")==1){
				if($("input:radio[name='reductionTypeRadio']:checked").length<=0){
					result = false;
					layer.msg("请选择减免金额类型！");
				}else{
					if($("#filmInitialAmount").val()==null&&$("#goodInitialAmount").val()==null){
						result = false;
						layer.msg("请输入减免金额！");
					}
					if($("input:radio[name='reductionTypeRadio']:checked").length>0&&($("#reductionPrice").val()==null||$("#reductionPrice").val()=="")){
						result = false;
						layer.msg("请输入减免金额！");
					}
				}
			}
			//影片选择
			if($("#roleId").val()!=1){
				$("#cinemaCodes").val($("#AllCinemaCodes").val());
				$("#canUseCinemaType").val("2");
			}
			
			if(result == true){
				$('#form').bootstrapValidator();
				var bootstrapValidator = $("#form").data('bootstrapValidator');
				bootstrapValidator.validate();
			    if(!bootstrapValidator.isValid()){
				   return;
			    }
			    
			    var formdata = $("#form").serializeObject();
			    $.ajax({
					type : 'post',
					url : '/couponsgroups',
					contentType: "application/json; charset=utf-8",  
					data : JSON.stringify(formdata),
					success : function(data) {
						layer.msg("添加成功", {shift: -1, time: 1000}, function(){
	                        location.href = "couponsgroupList.html";
	                    });
					}
				});
			}
			
		}
		
	</script>
</body>
</html>
